Vulnerability 1

1. Type: 
    Broken Authentication -- Week Password Patthern

2. Source Code and Root Cause:
    - Lines 46. The initial admin password list are all commonly used password that can be easily attacked by brute force.

3. How the Vulnerability Could be Exploited:
    
    There are two main methods to exploit this vulnerability:
    
    * Online Dictionary Attack:
        Attackers might use online dictionary attacks against the adminâ€™s account. They can try passwords from a list of commonly used password, as seen here: 

        https://en.wikipedia.org/wiki/List_of_the_most_common_passwords. 

        They can start with the most frequently used one, with three chances to guess the password right. Even though our application imposes a limit on login attempts, there is still a relatively high probability that attackers can guess the correct password.


    * Offline Dictionary Attack:
        Hackers can execute offline dictionary attacks once they obtain the admin's hashed password. This becomes feasible if database data is leaked, which is another vulnerability we will address later. Additionally, this web service uses MD5 (another vulnerability we will discuss), making it more susceptible to offline brute force attacks.

4. Impact of the Vulnerability:
    Hackers can exploit this vulnerability to employ offline dictionary attack and gain access to any users' account, including that of the admin. This could lead to the leak of user information as each user's messages are private. Furthermore, upon gaining admin access, hackers might exploit the web application even further. We will also discuss how to exploit this web app after have gained access to admin account later.

5. How the Vulnerability was Addressed:
    We should update every password in the initial list with a more intricate variant. Additionally, introducing salt and pepper to the authentication process will significantly bolster password complexity. It's also paramount to replace the outdated MD5 with a modern hashing function, a topic we'll delve into later.

    Furthermore, it's imperative not to hardcode passwords directly into source code. This presents a substantial risk, especially if malicious individuals gain access to our code repository. Doing so would directly provide attackers with a valid list of passwords, facilitating their dictionary attacks.

Vulnerability 2


1. Type: 
    Broken Authentication - Weak Hashing Algorithm

2. Source Code and Root Cause:
    Line 36. The code employs the MD5 hash function for passwords. MD5 is known to be unsafe to bruteforce attakcs and is not suitable for production environments.

3. How the Vulnerability Could be Exploited:
    Attackers can exploit this vulnerability in conjunction with other security vulnerability to bypass authentication. For example, if attackers exploit another vulnerability to access the database, they can obtain the hashed passwords of all users. Subsequently, they can attempt to brute force these hashed passwords. The situation is exacerbated if the hacker also uses dictionary attacks, as highlighted in vulnerability 1, to accelerate the brute force process.

4. Impact of the Vulnerability:
    When combined with other vulnerabilities, this weakness can lead to significant user information leaks. Moreover, it might allow hackers to gain access to admin account, opening the door for even more severe attacks.

5. How the Vulnerability was Addressed:
    We can replace the MD5 algorithm with a more robust hashing algorithm such as Argon2 or another contemporary hash function.

Vulnerability 3

1. Type: Broken Access Control

2. Source Code and Root Cause:
    line 315. Here is the code when users needs to download files and server needs to validate whether the filename is valid. However, the code only examine whether the filename is the same as user, not examine whether the extension name is qualified.

3. How the Vulnerability Could be Exploited:
    Hackers can use this vulnerability to download "database.db" which is the file of database of messages and usernames. Below is the concrete steps:

    1. Hacker sign up a user named "database"
    2. Hacker login as the user "database"
    3. Hacker directly request api "http://localhost:80/download?file=database.db"

    Because the code here will only check whether the username in the cookie is equal to filename without extension, which is "database", hacker now can direclty download "database.db".

4. Impact of the Vulnerability:
    It is obvious after getting access to database, hackers can now access to all private user data. Furthermore, this web server use a very weak hash algorithm md5, making hackers very easy to brutefroce all the hashed password and getting access to all user's account includes admin account, makeing it feasible to exploit more using admin account.

5. How the Vulnerability was Addressed:
    There are multiple ways to address this problem. 
    * Adding the file extension check
        This is the most easy one, we only need to check whether the file extension is csv or json, we can eliminate this vulnerability here.

    * Using signed cookie to store the filename
        The normal procedure for a user to download the message file is user should firstly pick a format of message, then server will get to create the file. Then user will download the file. We can set a new signed cookie which includes the current file chosen by user, then when user is actually download the file, we will directly use the filename from cookie. In this way we can avoid filename been manipulated by hackers.

Vulnerability 

1. Type: 

2. Source Code and Root Cause:

3. How the Vulnerability Could be Exploited:
    

4. Impact of the Vulnerability:

5. How the Vulnerability was Addressed: